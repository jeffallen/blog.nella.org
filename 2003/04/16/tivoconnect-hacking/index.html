<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>TiVoConnect Hacking | jra&#39;s thoughts</title>
<meta name="keywords" content="">
<meta name="description" content="Tonite I set out to make my Tivo use my remotely-hosted Linux webserver as my MP3 server. The eventual goal is to teach WinAmp to play from the same collection of files, so that I can have one copy of my mp3&rsquo;s in the &ldquo;cloud&rdquo; and still get access to them easily on each device.
The first step was to investigate the TiVo Developers info. There I found a tar.gz file with some stuff in it that implemented the funky XML messages TiVo needs to know what&rsquo;s in the directory tree. I fetched it put it in a directory on my webserver.">
<meta name="author" content="jra">
<link rel="canonical" href="https://blog.nella.org/2003/04/16/tivoconnect-hacking/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3beea2776320e39a6c8d0589cd10cf4cbbbe3ca9b6f0363cfeef1417ed39a195.css" integrity="sha256-O&#43;6id2Mg45psjQWJzRDPTLu&#43;PKm28DY8/u8UF&#43;05oZU=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://blog.nella.org/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.nella.org/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.nella.org/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.nella.org/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.nella.org/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://blog.nella.org/2003/04/16/tivoconnect-hacking/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lexend&display=swap" rel="stylesheet">
<meta property="og:url" content="https://blog.nella.org/2003/04/16/tivoconnect-hacking/">
  <meta property="og:site_name" content="jra&#39;s thoughts">
  <meta property="og:title" content="TiVoConnect Hacking">
  <meta property="og:description" content="Tonite I set out to make my Tivo use my remotely-hosted Linux webserver as my MP3 server. The eventual goal is to teach WinAmp to play from the same collection of files, so that I can have one copy of my mp3’s in the “cloud” and still get access to them easily on each device.
The first step was to investigate the TiVo Developers info. There I found a tar.gz file with some stuff in it that implemented the funky XML messages TiVo needs to know what’s in the directory tree. I fetched it put it in a directory on my webserver.">
  <meta property="og:locale" content="en-US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2003-04-16T02:59:42+00:00">
    <meta property="article:modified_time" content="2003-04-16T02:59:42+00:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TiVoConnect Hacking">
<meta name="twitter:description" content="Tonite I set out to make my Tivo use my remotely-hosted Linux webserver as my MP3 server. The eventual goal is to teach WinAmp to play from the same collection of files, so that I can have one copy of my mp3&rsquo;s in the &ldquo;cloud&rdquo; and still get access to them easily on each device.
The first step was to investigate the TiVo Developers info. There I found a tar.gz file with some stuff in it that implemented the funky XML messages TiVo needs to know what&rsquo;s in the directory tree. I fetched it put it in a directory on my webserver.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://blog.nella.org/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "TiVoConnect Hacking",
      "item": "https://blog.nella.org/2003/04/16/tivoconnect-hacking/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "TiVoConnect Hacking",
  "name": "TiVoConnect Hacking",
  "description": "Tonite I set out to make my Tivo use my remotely-hosted Linux webserver as my MP3 server. The eventual goal is to teach WinAmp to play from the same collection of files, so that I can have one copy of my mp3\u0026rsquo;s in the \u0026ldquo;cloud\u0026rdquo; and still get access to them easily on each device.\nThe first step was to investigate the TiVo Developers info. There I found a tar.gz file with some stuff in it that implemented the funky XML messages TiVo needs to know what\u0026rsquo;s in the directory tree. I fetched it put it in a directory on my webserver.\n",
  "keywords": [
    
  ],
  "articleBody": "Tonite I set out to make my Tivo use my remotely-hosted Linux webserver as my MP3 server. The eventual goal is to teach WinAmp to play from the same collection of files, so that I can have one copy of my mp3’s in the “cloud” and still get access to them easily on each device.\nThe first step was to investigate the TiVo Developers info. There I found a tar.gz file with some stuff in it that implemented the funky XML messages TiVo needs to know what’s in the directory tree. I fetched it put it in a directory on my webserver.\nNext, I realized I needed a beacon that I could point my TiVo at using “Manually Add Server…”. So I put this script together, using the beacon message doc as guidance, and the helpful beacon captures at KahunaBurger. Here is my beacon program:\n#!/usr/bin/perl -w $| = 1; $host=`uname -n`; $hostid=`hostid`; $plat=`uname -a`; chomp $host; chomp $hostid; chomp $plat; print \"TiVoConnect=1 Machine=$host Identity=hostid-$hostid Method=Connected Platform=$plat Services=TiVoMediaServer:80/http \"; while (\u003cSTDIN\u003e) { # ignore it } exit 0; I run it with a command like this: tcpserver -d -v `uname -n` 2190 ~/bin/tivo-beacon. You can find tcpserver at the ucspi-tcp page on djb’s site.\nNext, you need to arrange for URL’s like http://ip-addr/TiVoConnect?params... to turn into hits on the example.cgi script from the tarball. This turns out to be harder than necessary for two reasons. First, since TiVo only knows the IP address, not the hostname, it can’t fetch from a name-based virtual. Second, a bug in TiVo’s implementation of HTTP redirects makes the name change to lower case.\nTo get around the no-virtuals problem, I had to put a symlink in the root of the real webserver pointing at my home directory, where my virtuals run from. I have root, so it was no problem.\nNext, I renamed “example.cgi” to “index.cgi” and added a local .htaccess file that enabled CGI (“Options +ExecCGI”). Alas, that didn’t work because Apache issues a redirect from http://ip-addr/TiVoConnect?params... to http://ip-addr/TiVoConnect/?params.... Note the trailing slash. That is correct behavior when accessing a directory, and it shouldn’t be a problem. But since TiVo uncapitalizes the contents of the Location header when it follows an HTTP redirect it ends up trying to fetch http://ip-addr/ticoconnect/?params. So, you have to make a symlink in lowercase too.\nYou also need to edit the first bit of example.cgi and tell it where your photos and/or MP3’s are.\nAfter doing all that (and remembering that your webserver has a firewall, and it needs a hole poked for port 2190), it all just magically works! OK, well not really. It’s working some, but things are seriously flaky at this point still. I’ve just noticed that they don’t seem to be following the discovery spec when they send via TCP, so I’m going to try to copy the thing they are doing and see if maybe things will get better.\n",
  "wordCount" : "486",
  "inLanguage": "en",
  "datePublished": "2003-04-16T02:59:42Z",
  "dateModified": "2003-04-16T02:59:42Z",
  "author":{
    "@type": "Person",
    "name": "jra"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.nella.org/2003/04/16/tivoconnect-hacking/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "jra's thoughts",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.nella.org/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.nella.org/" accesskey="h" title="jra&#39;s thoughts (Alt + H)">jra&#39;s thoughts</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://blog.nella.org/">Home</a>&nbsp;»&nbsp;<a href="https://blog.nella.org/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      TiVoConnect Hacking
    </h1>
    <div class="post-meta"><span title='2003-04-16 02:59:42 +0000 +0000'>April 16, 2003</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;jra

</div>
  </header> 
  <div class="post-content"><p>Tonite I set out to make my Tivo use my remotely-hosted Linux webserver as my MP3 server. The eventual goal is to teach WinAmp to play from the same collection of files, so that I can have one copy of my mp3&rsquo;s in the &ldquo;cloud&rdquo; and still get access to them easily on each device.</p>
<p>The first step was to investigate the <a href="https://web.archive.org/web/20030408073412/http://www.tivo.com/developer/">TiVo Developers info</a>. There I found <a href="https://web.archive.org/web/20030408073412/http://www.tivo.com/developer/i/TiVoPM_032003.tar.gz">a tar.gz file</a> with some stuff in it that implemented the funky XML messages TiVo needs to know what&rsquo;s in the directory tree. I fetched it put it in a directory on my webserver.</p>
<p>Next, I realized I needed a beacon that I could point my TiVo at using &ldquo;Manually Add Server&hellip;&rdquo;. So I put this script together, using the beacon message doc as guidance, and the helpful <a href="http://www.kahunaburger.com/blog/archives/000053.html#000053">beacon captures</a> at KahunaBurger. Here is my beacon program:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/perl -w
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#f92672">|</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>host<span style="color:#f92672">=`</span>uname <span style="color:#f92672">-</span>n<span style="color:#f92672">`</span>;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>hostid<span style="color:#f92672">=`</span>hostid<span style="color:#f92672">`</span>;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>plat<span style="color:#f92672">=`</span>uname <span style="color:#f92672">-</span>a<span style="color:#f92672">`</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>chomp <span style="color:#960050;background-color:#1e0010">$</span>host;
</span></span><span style="display:flex;"><span>chomp <span style="color:#960050;background-color:#1e0010">$</span>hostid;
</span></span><span style="display:flex;"><span>chomp <span style="color:#960050;background-color:#1e0010">$</span>plat;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print <span style="color:#e6db74">&#34;TiVoConnect=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Machine=$host
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Identity=hostid-$hostid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Method=Connected
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Platform=$plat
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Services=TiVoMediaServer:80/http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> (<span style="color:#f92672">&lt;</span>STDIN<span style="color:#f92672">&gt;</span>) <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ignore it
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">exit</span> <span style="color:#ae81ff">0</span>;
</span></span></code></pre></div><p>I run it with a command like this: <code>tcpserver -d -v `uname -n` 2190 ~/bin/tivo-beacon</code>. You can find tcpserver at the <a href="http://cr.yp.to/ucspi-tcp.html">ucspi-tcp page</a> on djb&rsquo;s site.</p>
<p>Next, you need to arrange for URL&rsquo;s like <code>http://ip-addr/TiVoConnect?params...</code> to turn into hits on the example.cgi script from the tarball. This turns out to be harder than necessary for two reasons. First, since TiVo only knows the IP address, not the hostname, it can&rsquo;t fetch from a name-based virtual. Second, a bug in TiVo&rsquo;s implementation of HTTP redirects makes the name change to lower case.</p>
<p>To get around the no-virtuals problem, I had to put a symlink in the root of the real webserver pointing at my home directory, where my virtuals run from. I have root, so it was no problem.</p>
<p>Next, I renamed &ldquo;example.cgi&rdquo; to &ldquo;index.cgi&rdquo; and added a local .htaccess file that enabled CGI (&ldquo;Options +ExecCGI&rdquo;). Alas, that didn&rsquo;t work because Apache issues a redirect from <code>http://ip-addr/TiVoConnect?params...</code> to <code>http://ip-addr/TiVoConnect/?params...</code>. Note the trailing slash. That is correct behavior when accessing a directory, and it shouldn&rsquo;t be a problem. But since TiVo uncapitalizes the contents of the Location header when it follows an HTTP redirect it ends up trying to fetch <code>http://ip-addr/ticoconnect/?params</code>. So, you have to make a symlink in lowercase too.</p>
<p>You also need to edit the first bit of example.cgi and tell it where your photos and/or MP3&rsquo;s are.</p>
<p>After doing all that (and remembering that your webserver has a firewall, and it needs a hole poked for port 2190), it all just magically works! OK, well not really. It&rsquo;s working some, but things are seriously flaky at this point still. I&rsquo;ve just noticed that they don&rsquo;t seem to be following the <a href="http://a423.g.akamai.net/7/423/1788/3e68318a7ea60a/www.tivo.com/developer/i/TiVoConnectDiscovery.pdf">discovery spec</a> when they send via TCP, so I&rsquo;m going to try to copy the thing they are doing and see if maybe things will get better.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share TiVoConnect Hacking on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.nella.org%2f2003%2f04%2f16%2ftivoconnect-hacking%2f&amp;title=TiVoConnect%20Hacking&amp;summary=TiVoConnect%20Hacking&amp;source=https%3a%2f%2fblog.nella.org%2f2003%2f04%2f16%2ftivoconnect-hacking%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share TiVoConnect Hacking on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=TiVoConnect%20Hacking&u=https%3a%2f%2fblog.nella.org%2f2003%2f04%2f16%2ftivoconnect-hacking%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
