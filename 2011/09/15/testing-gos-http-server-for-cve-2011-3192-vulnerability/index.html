<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Testing Go&#39;s HTTP server for CVE-2011-3192 vulnerability | jra&#39;s thoughts</title>
<meta name="keywords" content="">
<meta name="description" content="The recent DoS attack on Apache is caused by sending in a malformed Range header. I decided to send the same header into Go&rsquo;s range header parser and see what happened. It passed with flying colors, giving the &ldquo;invalid range&rdquo; error, which would result in the Go webserver sending back HTTP response code 416 to the HTTP client.
I didn&rsquo;t test this under load (which is part of what the DoS was doing), but my quick reading of parseRange leads me to believe that the only effect of sending Range headers in like this is that garbage is created under control of the attacker (for example, due to strings.Split(s[len(b):], &ldquo;,&rdquo;)). Of course, that&rsquo;s bad and should be limited. However, this risk is no greater than other places in the server. For example an attacker could send an unlimited number of headers, or headers of unlimited length. This is already mentioned in the net/textproto package&rsquo;s reader.go.">
<meta name="author" content="jra">
<link rel="canonical" href="https://blog.nella.org/2011/09/15/testing-gos-http-server-for-cve-2011-3192-vulnerability/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3beea2776320e39a6c8d0589cd10cf4cbbbe3ca9b6f0363cfeef1417ed39a195.css" integrity="sha256-O&#43;6id2Mg45psjQWJzRDPTLu&#43;PKm28DY8/u8UF&#43;05oZU=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://blog.nella.org/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.nella.org/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.nella.org/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.nella.org/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.nella.org/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://blog.nella.org/2011/09/15/testing-gos-http-server-for-cve-2011-3192-vulnerability/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lexend&display=swap" rel="stylesheet">
<meta property="og:url" content="https://blog.nella.org/2011/09/15/testing-gos-http-server-for-cve-2011-3192-vulnerability/">
  <meta property="og:site_name" content="jra&#39;s thoughts">
  <meta property="og:title" content="Testing Go&#39;s HTTP server for CVE-2011-3192 vulnerability">
  <meta property="og:description" content="The recent DoS attack on Apache is caused by sending in a malformed Range header. I decided to send the same header into Go’s range header parser and see what happened. It passed with flying colors, giving the “invalid range” error, which would result in the Go webserver sending back HTTP response code 416 to the HTTP client.
I didn’t test this under load (which is part of what the DoS was doing), but my quick reading of parseRange leads me to believe that the only effect of sending Range headers in like this is that garbage is created under control of the attacker (for example, due to strings.Split(s[len(b):], “,”)). Of course, that’s bad and should be limited. However, this risk is no greater than other places in the server. For example an attacker could send an unlimited number of headers, or headers of unlimited length. This is already mentioned in the net/textproto package’s reader.go.">
  <meta property="og:locale" content="en-US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2011-09-15T07:53:45+00:00">
    <meta property="article:modified_time" content="2011-09-15T07:53:45+00:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Testing Go&#39;s HTTP server for CVE-2011-3192 vulnerability">
<meta name="twitter:description" content="The recent DoS attack on Apache is caused by sending in a malformed Range header. I decided to send the same header into Go&rsquo;s range header parser and see what happened. It passed with flying colors, giving the &ldquo;invalid range&rdquo; error, which would result in the Go webserver sending back HTTP response code 416 to the HTTP client.
I didn&rsquo;t test this under load (which is part of what the DoS was doing), but my quick reading of parseRange leads me to believe that the only effect of sending Range headers in like this is that garbage is created under control of the attacker (for example, due to strings.Split(s[len(b):], &ldquo;,&rdquo;)). Of course, that&rsquo;s bad and should be limited. However, this risk is no greater than other places in the server. For example an attacker could send an unlimited number of headers, or headers of unlimited length. This is already mentioned in the net/textproto package&rsquo;s reader.go.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://blog.nella.org/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Testing Go's HTTP server for CVE-2011-3192 vulnerability",
      "item": "https://blog.nella.org/2011/09/15/testing-gos-http-server-for-cve-2011-3192-vulnerability/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Testing Go's HTTP server for CVE-2011-3192 vulnerability",
  "name": "Testing Go\u0027s HTTP server for CVE-2011-3192 vulnerability",
  "description": "The recent DoS attack on Apache is caused by sending in a malformed Range header. I decided to send the same header into Go\u0026rsquo;s range header parser and see what happened. It passed with flying colors, giving the \u0026ldquo;invalid range\u0026rdquo; error, which would result in the Go webserver sending back HTTP response code 416 to the HTTP client.\nI didn\u0026rsquo;t test this under load (which is part of what the DoS was doing), but my quick reading of parseRange leads me to believe that the only effect of sending Range headers in like this is that garbage is created under control of the attacker (for example, due to strings.Split(s[len(b):], \u0026ldquo;,\u0026rdquo;)). Of course, that\u0026rsquo;s bad and should be limited. However, this risk is no greater than other places in the server. For example an attacker could send an unlimited number of headers, or headers of unlimited length. This is already mentioned in the net/textproto package\u0026rsquo;s reader.go.\n",
  "keywords": [
    
  ],
  "articleBody": "The recent DoS attack on Apache is caused by sending in a malformed Range header. I decided to send the same header into Go’s range header parser and see what happened. It passed with flying colors, giving the “invalid range” error, which would result in the Go webserver sending back HTTP response code 416 to the HTTP client.\nI didn’t test this under load (which is part of what the DoS was doing), but my quick reading of parseRange leads me to believe that the only effect of sending Range headers in like this is that garbage is created under control of the attacker (for example, due to strings.Split(s[len(b):], “,”)). Of course, that’s bad and should be limited. However, this risk is no greater than other places in the server. For example an attacker could send an unlimited number of headers, or headers of unlimited length. This is already mentioned in the net/textproto package’s reader.go.\nI did notice something strange while looking into this, which is that there’s a constant named maxHeaderLines (1024) that is never referenced. This is probably because the (incorrectly non-plurally-named) textproto.ReadMIMEHead er is now in charge of reading all the headers, but it does not accept a max headers parameter.\nThe fact that this particular constructed header causes no problem is no great surprise, because this attack was highly targeted at Apache. But it is nice to see that Go’s webserver is already (somewhat) hardened against this type of attack.\nPS: Here’s a diff showing how I tested this. It might be interesting for beginner Go folks to see how to generate test data at test time.\ndiff --git a/src/pkg/http/range_test.go b/src/pkg/http/range_test.go --- a/src/pkg/http/range_test.go +++ b/src/pkg/http/range_test.go @@ -6,13 +6,16 @@ import ( \"testing\" +\t\"fmt\" ) -var ParseRangeTests = []struct { +type testDef struct { s string length int64 r []httpRange -}{ +} + +var ParseRangeTests = []testDef{ {\"\", 0, nil}, {\"foo\", 0, nil}, {\"bytes=\", 0, nil}, @@ -34,6 +37,16 @@ {\"bytes=500-700,601-999\", 10000, []httpRange{{500, 201}, {601, 399}}}, } +func init() { + var p string + for k:=0 ; k\u003c1300 ; k++ { +\tp += \",5-\" +\tp += fmt.Sprintf(\"%d\", k) + } + x := \"bytes=0-\" + p + ParseRangeTests = append(ParseRangeTests, testDef{ x, 10, []httpRange{} }) +} + func TestParseRange(t *testing.T) { for _, test := range ParseRangeTests { r := test.r As set up right now, it won’t pass. This is because I wanted to see the exact error it was returning. If you change the []httpRange{} to nil, it will pass.\nPPS: Looks like someone else has been thinking about this as well.\n",
  "wordCount" : "431",
  "inLanguage": "en",
  "datePublished": "2011-09-15T07:53:45Z",
  "dateModified": "2011-09-15T07:53:45Z",
  "author":{
    "@type": "Person",
    "name": "jra"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.nella.org/2011/09/15/testing-gos-http-server-for-cve-2011-3192-vulnerability/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "jra's thoughts",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.nella.org/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.nella.org/" accesskey="h" title="jra&#39;s thoughts (Alt + H)">jra&#39;s thoughts</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://blog.nella.org/">Home</a>&nbsp;»&nbsp;<a href="https://blog.nella.org/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Testing Go&#39;s HTTP server for CVE-2011-3192 vulnerability
    </h1>
    <div class="post-meta"><span title='2011-09-15 07:53:45 +0000 +0000'>September 15, 2011</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;jra

</div>
  </header> 
  <div class="post-content"><p>The recent <a href="http://lists.grok.org.uk/pipermail/full-disclosure/attachments/20110820/848b4dca/attachment.obj">DoS attack on Apache</a> is caused by sending in a malformed Range header. I decided to send the same header into Go&rsquo;s range header parser and see what happened. It passed with flying colors, giving the &ldquo;invalid range&rdquo; error, which would result in the Go webserver sending back HTTP response code 416 to the HTTP client.</p>
<p>I didn&rsquo;t test this under load (which is part of what the DoS was doing), but my quick reading of parseRange leads me to believe that the only effect of sending Range headers in like this is that garbage is created under control of the attacker (for example, due to strings.Split(s[len(b):], &ldquo;,&rdquo;)). Of course, that&rsquo;s bad and should be limited. However, this risk is no greater than other places in the server. For example an attacker could send an unlimited number of headers, or headers of unlimited length. This is already mentioned in the net/textproto package&rsquo;s <a href="http://golang.org/src/pkg/net/textproto/reader.go#L16">reader.go</a>.</p>
<p>I did notice something strange while looking into this, which is that there&rsquo;s a constant named maxHeaderLines (1024) that is never referenced. This is probably because the (incorrectly non-plurally-named) textproto.ReadMIMEHead <strong>er</strong> is now in charge of reading <strong>all the headers</strong>, but it does not accept a max headers parameter.</p>
<p>The fact that this particular constructed header causes no problem is no great surprise, because this attack was highly targeted at Apache. But it is nice to see that Go&rsquo;s webserver is already (somewhat) hardened against this type of attack.</p>
<p>PS: Here&rsquo;s a diff showing how I tested this. It might be interesting for beginner Go folks to see how to generate test data at test time.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>diff <span style="color:#f92672">--</span>git a<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>pkg<span style="color:#f92672">/</span>http<span style="color:#f92672">/</span>range_test<span style="color:#f92672">.</span>go b<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>pkg<span style="color:#f92672">/</span>http<span style="color:#f92672">/</span>range_test<span style="color:#f92672">.</span>go
</span></span><span style="display:flex;"><span><span style="color:#f92672">---</span> a<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>pkg<span style="color:#f92672">/</span>http<span style="color:#f92672">/</span>range_test<span style="color:#f92672">.</span>go
</span></span><span style="display:flex;"><span><span style="color:#f92672">+++</span> b<span style="color:#f92672">/</span>src<span style="color:#f92672">/</span>pkg<span style="color:#f92672">/</span>http<span style="color:#f92672">/</span>range_test<span style="color:#f92672">.</span>go
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@@</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span><span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">16</span> <span style="color:#960050;background-color:#1e0010">@@</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> import (
</span></span><span style="display:flex;"><span> 	<span style="color:#e6db74">&#34;testing&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span> )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span><span style="color:#66d9ef">var</span> ParseRangeTests <span style="color:#f92672">=</span> []struct {
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>type testDef struct {
</span></span><span style="display:flex;"><span> 	s      string
</span></span><span style="display:flex;"><span> 	length int64
</span></span><span style="display:flex;"><span> 	r      []httpRange
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>}{
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#66d9ef">var</span> ParseRangeTests <span style="color:#f92672">=</span> []testDef{
</span></span><span style="display:flex;"><span> 	{<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">0</span>, nil},
</span></span><span style="display:flex;"><span> 	{<span style="color:#e6db74">&#34;foo&#34;</span>, <span style="color:#ae81ff">0</span>, nil},
</span></span><span style="display:flex;"><span> 	{<span style="color:#e6db74">&#34;bytes=&#34;</span>, <span style="color:#ae81ff">0</span>, nil},
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@@</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">34</span>,<span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span><span style="color:#ae81ff">37</span>,<span style="color:#ae81ff">16</span> <span style="color:#960050;background-color:#1e0010">@@</span>
</span></span><span style="display:flex;"><span> 	{<span style="color:#e6db74">&#34;bytes=500-700,601-999&#34;</span>, <span style="color:#ae81ff">10000</span>, []httpRange{{<span style="color:#ae81ff">500</span>, <span style="color:#ae81ff">201</span>}, {<span style="color:#ae81ff">601</span>, <span style="color:#ae81ff">399</span>}}},
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#66d9ef">func</span> init() {
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>  <span style="color:#66d9ef">var</span> p string
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>  <span style="color:#66d9ef">for</span> k:<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> ; k<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">1300</span> ; k<span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>	p <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;,5-&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>	p <span style="color:#f92672">+=</span> fmt<span style="color:#f92672">.</span>Sprintf(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>, k)
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>  }
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>  x :<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bytes=0-&#34;</span> <span style="color:#f92672">+</span> p
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>  ParseRangeTests <span style="color:#f92672">=</span> append(ParseRangeTests, testDef{ x, <span style="color:#ae81ff">10</span>, []httpRange{} })
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">func</span> TestParseRange(t <span style="color:#f92672">*</span>testing<span style="color:#f92672">.</span>T) {
</span></span><span style="display:flex;"><span> 	<span style="color:#66d9ef">for</span> _, test :<span style="color:#f92672">=</span> range ParseRangeTests {
</span></span><span style="display:flex;"><span> 		r :<span style="color:#f92672">=</span> test<span style="color:#f92672">.</span>r
</span></span></code></pre></div><p>As set up right now, it won&rsquo;t pass. This is because I wanted to see the exact error it was returning. If you change the []httpRange{} to nil, it will pass.</p>
<p>PPS: Looks like <a href="http://code.google.com/p/go/issues/detail?id=2093">someone else</a> has been thinking about this as well.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Testing Go&#39;s HTTP server for CVE-2011-3192 vulnerability on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.nella.org%2f2011%2f09%2f15%2ftesting-gos-http-server-for-cve-2011-3192-vulnerability%2f&amp;title=Testing%20Go%27s%20HTTP%20server%20for%20CVE-2011-3192%20vulnerability&amp;summary=Testing%20Go%27s%20HTTP%20server%20for%20CVE-2011-3192%20vulnerability&amp;source=https%3a%2f%2fblog.nella.org%2f2011%2f09%2f15%2ftesting-gos-http-server-for-cve-2011-3192-vulnerability%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Testing Go&#39;s HTTP server for CVE-2011-3192 vulnerability on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Testing%20Go%27s%20HTTP%20server%20for%20CVE-2011-3192%20vulnerability&u=https%3a%2f%2fblog.nella.org%2f2011%2f09%2f15%2ftesting-gos-http-server-for-cve-2011-3192-vulnerability%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
